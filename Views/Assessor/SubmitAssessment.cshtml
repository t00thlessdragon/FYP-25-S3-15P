@model FYP_25_S3_15P.ViewModels.SubmitAssessmentVm
@{
    Layout = "~/Views/Shared/_AssessorLayout.cshtml";
    var from = (string?)ViewBag.From ?? "assessment";
}

<section class="container-wide card-xl">
  <div class="card rounded-4 p-4 p-lg-5 shadow-lg">

    <div class="d-flex justify-content-between align-items-start mb-3">
      <h2 class="mb-0">Submit Assessment</h2>
      <a class="btn-close" aria-label="Close"
         asp-action="@(from == "tasks" ? "TaskDeliverables" : "Assessment")"></a>
    </div>

    <div class="fs-5 mb-3">
      <div class="mb-1"><strong>Project ID:</strong> @Model.ProjectId</div>
      <div class="mb-1"><strong>Project Title:</strong> @Model.ProjectTitle</div>
      <div class="mb-1"><strong>Group ID:</strong> @Model.GroupId</div>
      <div class="mb-1"><strong>Supervisor:</strong> @Model.Supervisor</div>
      <div class="mb-1"><strong>Assessor Assigned:</strong> @Model.Assessor</div>
      <div class="mb-2"><strong>Project Member:</strong>
        <div class="ps-4">
          @foreach (var m in Model.Members) { <div>@m</div> }
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead class="table-dark">
          <tr>
            <th style="width:140px;">Task ID</th>
            <th>Task Title</th>
            <th style="width:200px;">Score (out of 100)</th>
            <th style="width:200px;">Contribution %</th>
            <th style="width:220px;">Final Contribution</th>
          </tr>
        </thead>
        <tbody>
        @foreach (var t in Model.Tasks)
        {
          <tr>
            <td>@t.TaskId</td>
            <td class="fw-semibold">@t.TaskTitle</td>
            <td>@t.ScoreOutOf100</td>
            <td>@t.ContributionPercent%</td>
            <td>@(Math.Round(t.ScoreOutOf100 * (t.ContributionPercent/100m), 2))%</td>
          </tr>
        }
        </tbody>
      </table>
    </div>

    <div class="mt-3">
      <strong>Total Contribution to Overall Project:</strong> @Model.TotalContributionPercent%
    </div>

    <form asp-action="SubmitAssessment" method="post" class="d-flex justify-content-end mt-4">
      @Html.AntiForgeryToken()
      <input type="hidden" name="ProjectId" value="@Model.ProjectId" />
      <input type="hidden" name="ProjectTitle" value="@Model.ProjectTitle" />
      <input type="hidden" name="GroupId" value="@Model.GroupId" />
      <input type="hidden" name="TotalContributionPercent" value="@Model.TotalContributionPercent" />
      <input type="hidden" name="from" value="@from" />
      <button type="submit" class="btn btn-dark btn-lg px-5">Submit</button>
    </form>

  </div>
</section>
